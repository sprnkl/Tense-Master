<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TenseMaster Pro (Grammar Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { primary: '#2563eb', secondary: '#475569' }
                }
            }
        }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 h-screen flex flex-col overflow-hidden">

<header class="bg-white shadow-sm z-20 flex-none">
    <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
        <h1 class="text-xl font-bold text-primary tracking-tight flex items-center gap-2">
            <span class="material-symbols-outlined">school</span> TenseMaster
        </h1>
        <button onclick="window.location.reload()" class="text-slate-400 hover:text-primary transition">
            <span class="material-symbols-outlined">refresh</span>
        </button>
    </div>
    <div class="relative border-b border-slate-200 bg-white">
        <div class="max-w-4xl mx-auto flex overflow-x-auto no-scrollbar py-2 px-2 gap-2" id="nav-container"></div>
        <div class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white to-transparent pointer-events-none md:hidden"></div>
    </div>
</header>

<main class="flex-grow overflow-y-auto p-4 relative" id="main-content"></main>

<div id="floating-action-container" class="fixed bottom-6 left-4 right-4 z-30 hidden">
    <button onclick="reloadQuestions()" class="w-full bg-slate-800 text-white shadow-xl py-4 rounded-2xl font-bold active:scale-95 transition flex items-center justify-center gap-2 backdrop-blur-md bg-opacity-90 border border-slate-700/50">
        <span class="material-symbols-outlined">refresh</span>
        5 neue SÃ¤tze laden
    </button>
</div>

<script>
    // =========================
    // Hilfsdaten: Subjekte, Verben
    // =========================

    const subjects = [
        { label: "I",           bePres: "am",  bePast: "was",  havePres: "have", is3sg: false },
        { label: "you",         bePres: "are", bePast: "were", havePres: "have", is3sg: false },
        { label: "he",          bePres: "is",  bePast: "was",  havePres: "has",  is3sg: true  },
        { label: "she",         bePres: "is",  bePast: "was",  havePres: "has",  is3sg: true  },
        { label: "it",          bePres: "is",  bePast: "was",  havePres: "has",  is3sg: true  },
        { label: "we",          bePres: "are", bePast: "were", havePres: "have", is3sg: false },
        { label: "they",        bePres: "are", bePast: "were", havePres: "have", is3sg: false },
        { label: "my brother",  bePres: "is",  bePast: "was",  havePres: "has",  is3sg: true  },
        { label: "my sister",   bePres: "is",  bePast: "was",  havePres: "has",  is3sg: true  },
        { label: "my parents",  bePres: "are", bePast: "were", havePres: "have", is3sg: false },
        { label: "the dog",     bePres: "is",  bePast: "was",  havePres: "has",  is3sg: true  },
        { label: "the children",bePres: "are", bePast: "were", havePres: "have", is3sg: false }
    ];

    const verbsRegular = [
        { infLabel: "to play",   base: "play",   past: "played",   pp: "played",   ing: "playing"   },
        { infLabel: "to watch",  base: "watch",  past: "watched",  pp: "watched",  ing: "watching"  },
        { infLabel: "to open",   base: "open",   past: "opened",   pp: "opened",   ing: "opening"   },
        { infLabel: "to clean",  base: "clean",  past: "cleaned",  pp: "cleaned",  ing: "cleaning"  },
        { infLabel: "to visit",  base: "visit",  past: "visited",  pp: "visited",  ing: "visiting"  },
        { infLabel: "to walk",   base: "walk",   past: "walked",   pp: "walked",   ing: "walking"   },
        { infLabel: "to talk",   base: "talk",   past: "talked",   pp: "talked",   ing: "talking"   },
        { infLabel: "to help",   base: "help",   past: "helped",   pp: "helped",   ing: "helping"   },
        { infLabel: "to study",  base: "study",  past: "studied",  pp: "studied",  ing: "studying"  },
        { infLabel: "to start",  base: "start",  past: "started",  pp: "started",  ing: "starting"  }
    ];

    const verbsIrregular = [
        { infLabel: "to go",    base: "go",    past: "went",  pp: "gone",   ing: "going"   },
        { infLabel: "to have",  base: "have",  past: "had",   pp: "had",    ing: "having"  },
        { infLabel: "to do",    base: "do",    past: "did",   pp: "done",   ing: "doing"   },
        { infLabel: "to eat",   base: "eat",   past: "ate",   pp: "eaten",  ing: "eating"  },
        { infLabel: "to see",   base: "see",   past: "saw",   pp: "seen",   ing: "seeing"  },
        { infLabel: "to make",  base: "make",  past: "made",  pp: "made",   ing: "making"  },
        { infLabel: "to take",  base: "take",  past: "took",  pp: "taken",  ing: "taking"  },
        { infLabel: "to come",  base: "come",  past: "came",  pp: "come",   ing: "coming"  },
        { infLabel: "to buy",   base: "buy",   past: "bought",pp: "bought", ing: "buying"  },
        { infLabel: "to write", base: "write", past: "wrote", pp: "written",ing: "writing" }
    ];

    const verbsAll = verbsRegular.concat(verbsIrregular);

    function present3sg(verb) {
        if (verb.endsWith("y") && !"aeiou".includes(verb[verb.length - 2])) {
            return verb.slice(0, -1) + "ies";
        }
        if (["ch","sh","s","x","z","o"].some(end => verb.endsWith(end))) {
            return verb + "es";
        }
        return verb + "s";
    }

    // =========================
    // Generator: Simple Present
    // =========================
    function generateSimplePresentPractice() {
        const items = [];
        const endings = ["after school.", "every day.", "on Mondays.", "in the morning.", "in the evening.", "at the weekend."];

        // positive (34)
        let i = 0;
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbsRegular[i % verbsRegular.length];
            const ending = endings[i % endings.length];
            const base = verb.base;
            let ans, hint;
            if (subj.is3sg) {
                ans = present3sg(base);
                hint = "He/She/It -> +s";
            } else {
                ans = base;
                hint = "Grundform";
            }
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative (33)
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbsRegular[(i + 2) % verbsRegular.length];
            const ending = endings[(i + 3) % endings.length];
            const base = verb.base;
            let aux, hint;
            if (subj.is3sg) {
                aux = "doesn't";
                hint = "He/She/It -> doesn't + Grundform";
            } else {
                aux = "don't";
                hint = "don't + Grundform";
            }
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}`;
            const ans = `${aux} ${base}`;
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions (33)
        i = 0;
        const qEndings = ["after school?", "every day?", "on Mondays?", "in the morning?", "in the evening?", "at the weekend?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbsRegular[(i + 4) % verbsRegular.length];
            const base = verb.base;
            let aux, hint;
            if (subj.is3sg) {
                aux = "Does";
                hint = "Does + Person + Grundform";
            } else {
                aux = "Do";
                hint = "Do + Person + Grundform";
            }
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `${aux} ${subj.label} ${base}`;
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Generator: Simple Past
    // =========================
    function generateSimplePastPractice() {
        const items = [];
        const endings = ["yesterday.", "last week.", "last year.", "two days ago.", "in 2019.", "an hour ago."];

        // positive (34)
        let i = 0;
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[i % verbsAll.length];
            const ending = endings[i % endings.length];
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            const ans = verb.past;
            const hint = `${verb.base} -> ${verb.past}`;
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative (33)
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 3) % verbsAll.length];
            const endingRaw = endings[(i + 2) % endings.length];
            const ending = endingRaw.replace(".", "");
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}.`;
            const ans = `didn't ${verb.base}`;
            const hint = "didn't + Grundform";
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions (33)
        i = 0;
        const qEndings = ["yesterday?", "last week?", "last night?", "two days ago?", "on Monday?", "in 2019?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 5) % verbsAll.length];
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `Did ${subj.label} ${verb.base}`;
            const hint = "Did + Person + Grundform";
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Generator: Present Progressive
    // =========================
    function generatePresentProgressivePractice() {
        const items = [];
        const verbs = verbsRegular.slice(0, 6);
        const endings = ["now.", "at the moment.", "right now.", "today.", "this morning.", "this evening."];

        // positive
        let i = 0;
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbs[i % verbs.length];
            const ending = endings[i % endings.length];
            const be = subj.bePres;
            const ing = verb.ing;
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            const ans = `${be} ${ing}`;
            let hint;
            if (be === "am") hint = "am + Verb-ing";
            else if (be === "is") hint = "is + Verb-ing";
            else hint = "are + Verb-ing";
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbs[(i + 2) % verbs.length];
            const ending = endings[(i + 1) % endings.length];
            let aux, hint;
            if (subj.bePres === "am") { aux = "am not"; hint = "am not + Verb-ing"; }
            else if (subj.bePres === "is") { aux = "isn't"; hint = "isn't + Verb-ing"; }
            else { aux = "aren't"; hint = "aren't + Verb-ing"; }
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}`;
            const ans = `${aux} ${verb.ing}`;
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions
        i = 0;
        const qEndings = ["now?", "at the moment?", "right now?", "today?", "this morning?", "this evening?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbs[(i + 4) % verbs.length];
            let aux;
            if (subj.bePres === "am") aux = "Am";
            else if (subj.bePres === "is") aux = "Is";
            else aux = "Are";
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `${aux} ${subj.label} ${verb.ing}`;
            const hint = `${aux} + Person + Verb-ing`;
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Generator: Past Progressive
    // =========================
    function generatePastProgressivePractice() {
        const items = [];
        const verbs = verbsRegular.slice(0, 6);
        const endings = ["yesterday at 5.", "when he called.", "while it rained.", "all evening.", "all day.", "at that moment."];

        // positive
        let i = 0;
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbs[i % verbs.length];
            const ending = endings[i % endings.length];
            const be = subj.bePast;
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            const ans = `${be} ${verb.ing}`;
            const hint = `${be} + Verb-ing`;
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbs[(i + 2) % verbs.length];
            const ending = endings[(i + 1) % endings.length];
            const aux = subj.bePast === "was" ? "wasn't" : "weren't";
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}`;
            const ans = `${aux} ${verb.ing}`;
            const hint = `${aux} + Verb-ing`;
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions
        i = 0;
        const qEndings = ["yesterday at 5?", "when he called?", "while it rained?", "all evening?", "all day?", "at that moment?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbs[(i + 4) % verbs.length];
            const aux = subj.bePast === "was" ? "Was" : "Were";
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `${aux} ${subj.label} ${verb.ing}`;
            const hint = `${aux} + Person + Verb-ing`;
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Generator: Will-Future
    // =========================
    function generateWillFuturePractice() {
        const items = [];
        const endings = ["tomorrow.", "next week.", "next month.", "soon.", "later.", "this evening."];

        let i = 0;
        // positive
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[i % verbsAll.length];
            const ending = endings[i % endings.length];
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            const ans = `will ${verb.base}`;
            const hint = "will + Grundform";
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 3) % verbsAll.length];
            const ending = endings[(i + 1) % endings.length];
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}`;
            const ans = `won't ${verb.base}`;
            const hint = "won't + Grundform";
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions
        i = 0;
        const qEndings = ["tomorrow?", "next week?", "next month?", "soon?", "later?", "this evening?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 5) % verbsAll.length];
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `Will ${subj.label} ${verb.base}`;
            const hint = "Will + Person + Grundform";
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Generator: Going-to-Future
    // =========================
    function generateGoingToFuturePractice() {
        const items = [];
        const endings = ["tomorrow.", "next week.", "next month.", "soon.", "later.", "this afternoon."];

        let i = 0;
        // positive
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[i % verbsAll.length];
            const ending = endings[i % endings.length];
            const be = subj.bePres;
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            const ans = `${be} going to ${verb.base}`;
            const hint = "am/is/are going to + Grundform";
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 3) % verbsAll.length];
            const ending = endings[(i + 1) % endings.length];
            let aux;
            if (subj.bePres === "am") aux = "am not going to";
            else if (subj.bePres === "is") aux = "isn't going to";
            else aux = "aren't going to";
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}`;
            const ans = `${aux} ${verb.base}`;
            const hint = "am/is/are not going to + Grundform";
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions
        i = 0;
        const qEndings = ["tomorrow?", "next week?", "next month?", "soon?", "later?", "this afternoon?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 5) % verbsAll.length];
            let aux;
            if (subj.bePres === "am") aux = "Am";
            else if (subj.bePres === "is") aux = "Is";
            else aux = "Are";
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `${aux} ${subj.label} going to ${verb.base}`;
            const hint = "Am/Is/Are + Person + going to + Grundform";
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Generator: Present Perfect
    // =========================
    function generatePresentPerfectPractice() {
        const items = [];
        const endingsPos = ["already.", "just now.", "today.", "this week.", "many times.", "before."];
        const endingsNeg = ["yet.", "today.", "this week.", "so far.", "before.", "this year."];

        let i = 0;
        // positive
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[i % verbsAll.length];
            const ending = endingsPos[i % endingsPos.length];
            const aux = subj.havePres;
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            const ans = `${aux} ${verb.pp}`;
            const hint = `${aux} + 3. Form`;
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 3) % verbsAll.length];
            const ending = endingsNeg[i % endingsNeg.length];
            const aux = subj.havePres === "has" ? "hasn't" : "haven't";
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}`;
            const ans = `${aux} ${verb.pp}`;
            const hint = `${aux} + 3. Form`;
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions
        i = 0;
        const qEndings = ["yet?", "today?", "this week?", "before?", "so far?", "this year?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 5) % verbsAll.length];
            const aux = subj.havePres === "has" ? "Has" : "Have";
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `${aux} ${subj.label} ${verb.pp}`;
            const hint = `${aux} + Person + 3. Form`;
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Generator: Past Perfect
    // =========================
    function generatePastPerfectPractice() {
        const items = [];
        const endingsPos = ["before I arrived.", "when the film started.", "before lunch.", "by 6 o'clock.", "before the test.", "when he called."];
        const endingsNeg = ["before I arrived.", "before the lesson.", "before lunch.", "by 6 o'clock.", "before the test.", "when he called."];

        let i = 0;
        // positive
        while (items.length < 34) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[i % verbsAll.length];
            const ending = endingsPos[i % endingsPos.length];
            const q = `${subj.label} _____ (${verb.infLabel}) ${ending}`;
            const ans = `had ${verb.pp}`;
            const hint = "had + 3. Form";
            items.push({ type: "pos", q, a: ans, hint });
            i++;
        }

        // negative
        i = 0;
        while (items.length < 34 + 33) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 3) % verbsAll.length];
            const ending = endingsNeg[i % endingsNeg.length];
            const q = `${subj.label} _____ (not / ${verb.infLabel}) ${ending}`;
            const ans = `hadn't ${verb.pp}`;
            const hint = "hadn't + 3. Form";
            items.push({ type: "neg", q, a: ans, hint });
            i++;
        }

        // questions
        i = 0;
        const qEndings = ["before I arrived?", "before the film started?", "before lunch?", "by 6 o'clock?", "before the test?", "when he called?"];
        while (items.length < 100) {
            const subj = subjects[i % subjects.length];
            const verb = verbsAll[(i + 5) % verbsAll.length];
            const q = `_____ (${verb.infLabel} / ${subj.label}) ${qEndings[i % qEndings.length]}`;
            const ans = `Had ${subj.label} ${verb.pp}`;
            const hint = "Had + Person + 3. Form";
            items.push({ type: "ques", q, a: ans, hint });
            i++;
        }

        return items;
    }

    // =========================
    // Alle Practice-Pools erzeugen
    // =========================
    const practicePools = {
        "simple-present": generateSimplePresentPractice(),
        "simple-past": generateSimplePastPractice(),
        "present-progressive": generatePresentProgressivePractice(),
        "past-progressive": generatePastProgressivePractice(),
        "will-future": generateWillFuturePractice(),
        "going-to-future": generateGoingToFuturePractice(),
        "present-perfect": generatePresentPerfectPractice(),
        "past-perfect": generatePastPerfectPractice()
    };

    // =========================
    // appData: jede Zeitform mit 100 Aufgaben
    // =========================
    const appData = [
        {
            id: "simple-present",
            name: "Simple Present",
            color: "from-blue-600 to-cyan-500",
            learn: {
                intro: "RegelmÃ¤ÃŸige Handlungen, Fakten, ZustÃ¤nde.",
                signalWords: ["always", "often", "usually", "sometimes", "never", "every day"],
                positive: {
                    rule: "Subjekt + Verb (He/She/It: das 's' muss mit!)",
                    examples: ["I play football.", "He reads a book.", "She goes to school."]
                },
                negative: {
                    rule: "don't / doesn't + Infinitiv",
                    examples: ["I don't play football.", "He doesn't read.", "They don't know."]
                },
                question: {
                    rule: "Do / Does + Subjekt + Infinitiv?",
                    examples: ["Do you play?", "Does he read?", "Do they know?"]
                }
            },
            practice: practicePools["simple-present"]
        },
        {
            id: "simple-past",
            name: "Simple Past",
            color: "from-emerald-600 to-teal-500",
            learn: {
                intro: "Abgeschlossene Vergangenheit.",
                signalWords: ["yesterday", "last week", "in 2010", "ago"],
                positive: {
                    rule: "Verb + ed (oder 2. Spalte)",
                    examples: ["I played.", "I went to school.", "He bought a car."]
                },
                negative: {
                    rule: "didn't + Infinitiv (Grundform!)",
                    examples: ["I didn't play.", "He didn't go (NICHT went!)"]
                },
                question: {
                    rule: "Did + Subjekt + Infinitiv?",
                    examples: ["Did you play?", "Did he go?"]
                }
            },
            practice: practicePools["simple-past"]
        },
        {
            id: "present-progressive",
            name: "Present Progressive",
            color: "from-indigo-600 to-purple-500",
            learn: {
                intro: "Was passiert JETZT gerade?",
                signalWords: ["now", "at the moment", "Look!", "Listen!"],
                positive: { rule: "am / is / are + ing", examples: ["I am reading.", "He is running."] },
                negative: { rule: "am not / isn't / aren't + ing", examples: ["I am not reading.", "He isn't running."] },
                question: { rule: "Am / Is / Are + Subjekt + ing?", examples: ["Are you reading?", "Is he running?"] }
            },
            practice: practicePools["present-progressive"]
        },
        {
            id: "will-future",
            name: "Will Future",
            color: "from-violet-600 to-fuchsia-600",
            learn: {
                intro: "Vorhersagen, Versprechen, Spontanes.",
                signalWords: ["tomorrow", "think", "hope", "maybe"],
                positive: { rule: "will + Infinitiv", examples: ["I will help you.", "It will rain."] },
                negative: { rule: "won't (will not) + Infinitiv", examples: ["I won't go.", "It won't rain."] },
                question: { rule: "Will + Subjekt + Infinitiv?", examples: ["Will you come?", "Will it rain?"] }
            },
            practice: practicePools["will-future"]
        },
        {
            id: "past-progressive",
            name: "Past Progressive",
            color: "from-green-600 to-lime-600",
            learn: {
                intro: "Handlung dauerte in Vergangenheit an (wurde oft unterbrochen).",
                signalWords: ["while", "when (Simple Past unterbricht)", "all day"],
                positive: { rule: "was / were + ing", examples: ["I was sleeping.", "They were playing."] },
                negative: { rule: "wasn't / weren't + ing", examples: ["I wasn't sleeping.", "They weren't playing."] },
                question: { rule: "Was / Were + Subjekt + ing?", examples: ["Was he sleeping?", "Were they playing?"] }
            },
            practice: practicePools["past-progressive"]
        },
        {
            id: "present-perfect",
            name: "Present Perfect",
            color: "from-orange-500 to-amber-500",
            learn: {
                intro: "Ergebnis wichtig oder Handlung dauert noch an.",
                signalWords: ["just", "yet", "never", "ever", "already", "since", "for"],
                positive: { rule: "have / has + 3. Spalte (ed)", examples: ["I have eaten.", "She has gone."] },
                negative: { rule: "haven't / hasn't + 3. Spalte", examples: ["I haven't eaten.", "She hasn't gone."] },
                question: { rule: "Have / Has + Subjekt + 3. Spalte?", examples: ["Have you eaten?", "Has she gone?"] }
            },
            practice: practicePools["present-perfect"]
        },
        {
            id: "past-perfect",
            name: "Past Perfect",
            color: "from-red-600 to-orange-600",
            learn: {
                intro: "Vorvergangenheit. Passierte VOR etwas anderem.",
                signalWords: ["before", "after"],
                positive: { rule: "had + 3. Spalte", examples: ["I had eaten before I slept."] },
                negative: { rule: "hadn't + 3. Spalte", examples: ["I hadn't eaten."] },
                question: { rule: "Had + Subjekt + 3. Spalte?", examples: ["Had you eaten?"] }
            },
            practice: practicePools["past-perfect"]
        },
        {
            id: "going-to-future",
            name: "Going-to Future",
            color: "from-pink-600 to-rose-500",
            learn: {
                intro: "Feste PlÃ¤ne oder logische Konsequenz.",
                signalWords: ["tomorrow", "next week", "planned"],
                positive: { rule: "am/is/are + going to + Infinitiv", examples: ["I am going to fly.", "He is going to fall."] },
                negative: { rule: "am not / isn't / aren't + going to + Infinitiv", examples: ["I am not going to fly."] },
                question: { rule: "Am/Is/Are + Subjekt + going to + Infinitiv?", examples: ["Are you going to fly?"] }
            },
            practice: practicePools["going-to-future"]
        }
    ];

    // =========================
    // Restliche App-Logik
    // =========================

    let currentTenseIndex = 0;
    let currentMode = "learn";
    let currentQuestions = [];

    const navContainer = document.getElementById("nav-container");
    const mainContent = document.getElementById("main-content");
    const floatingContainer = document.getElementById("floating-action-container");

    function getRandomQuestions(allQuestions, count = 5) {
        const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
    }

    window.onload = function() {
        if (appData.length > 0) {
            init();
        } else {
            document.body.innerHTML = "<div class='p-10 text-red-600 font-bold text-center'>Bitte Schritt 2 (Daten) einfÃ¼gen!</div>";
        }
    };

    function init() {
        renderNav();
        renderContent();
    }

    function renderNav() {
        navContainer.innerHTML = "";
        appData.forEach((tense, index) => {
            const isActive = index === currentTenseIndex;
            const btn = document.createElement("button");
            btn.className =
                "px-5 py-2.5 rounded-full text-sm font-bold transition-all whitespace-nowrap flex-shrink-0 border-2 " +
                (isActive
                    ? `bg-gradient-to-r ${tense.color} text-white border-transparent shadow-lg transform scale-105`
                    : "bg-white text-slate-500 border-slate-200 hover:border-slate-300 hover:bg-slate-50");
            btn.textContent = tense.name;
            btn.onclick = () => {
                currentTenseIndex = index;
                currentMode = "learn";
                currentQuestions = [];
                renderNav();
                renderContent();
            };
            navContainer.appendChild(btn);
        });
    }

    function renderContent() {
        const data = appData[currentTenseIndex];
        const practicePool = data.practice; // 100 SÃ¤tze

        mainContent.innerHTML = "";
        const container = document.createElement("div");
        container.className = "max-w-2xl mx-auto fade-in pb-32";

        const banner = `
            <div class="rounded-2xl bg-gradient-to-r ${data.color} p-6 text-white shadow-lg mb-6 relative overflow-hidden">
                <div class="relative z-10">
                    <h2 class="text-3xl font-extrabold tracking-tight mb-1">${data.name}</h2>
                    <p class="opacity-90 font-medium">${data.learn.intro}</p>
                </div>
                <span class="material-symbols-outlined absolute -right-4 -bottom-6 text-9xl opacity-20 rotate-12">school</span>
            </div>
        `;

        const modeSwitcher = `
            <div class="bg-white p-1.5 rounded-xl shadow-sm border border-slate-200 mb-6 flex">
                <button onclick="switchMode('learn')" class="flex-1 py-3 rounded-lg text-sm font-bold transition flex items-center justify-center gap-2 ${currentMode === "learn" ? "bg-slate-100 text-slate-800 shadow-inner" : "text-slate-500 hover:text-slate-700"}">
                    <span class="material-symbols-outlined">menu_book</span> Lernen
                </button>
                <button onclick="switchMode('practice')" class="flex-1 py-3 rounded-lg text-sm font-bold transition flex items-center justify-center gap-2 ${currentMode === "practice" ? "bg-slate-100 text-slate-800 shadow-inner" : "text-slate-500 hover:text-slate-700"}">
                    <span class="material-symbols-outlined">edit_note</span> Ãœben
                </button>
            </div>
        `;

        let contentHTML = "";

        if (currentMode === "learn") {
            floatingContainer.classList.add("hidden");

            const createCard = (title, icon, colorClass, textClass, content, examples) => `
                <div class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                    <div class="${colorClass} px-4 py-3 flex items-center gap-2 border-b border-slate-100">
                        <span class="material-symbols-outlined text-white">${icon}</span>
                        <span class="font-bold text-white uppercase text-sm tracking-wider">${title}</span>
                    </div>
                    <div class="p-5">
                        <p class="font-mono text-lg font-medium ${textClass} mb-4 bg-slate-50 p-3 rounded-lg border border-slate-100">${content}</p>
                        <div class="space-y-2">
                            ${examples.map(ex => `<div class="text-slate-600 text-sm flex gap-2"><span class="text-slate-400">â€¢</span> ${ex}</div>`).join("")}
                        </div>
                    </div>
                </div>
            `;

            contentHTML = `
                <div class="space-y-6">
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="text-xs uppercase tracking-wider text-slate-400 font-bold mb-3">SignalwÃ¶rter</h3>
                        <div class="flex flex-wrap gap-2">
                            ${data.learn.signalWords.map(w => `<span class="bg-slate-100 text-slate-700 px-3 py-1.5 rounded-lg text-sm font-semibold border border-slate-200">${w}</span>`).join("")}
                        </div>
                    </div>

                    ${createCard("Aussage", "add_circle", "bg-green-500", "text-green-700", data.learn.positive.rule, data.learn.positive.examples)}
                    ${createCard("Verneinung", "cancel", "bg-red-500", "text-red-700", data.learn.negative.rule, data.learn.negative.examples)}
                    ${createCard("Frage", "help", "bg-blue-500", "text-blue-700", data.learn.question.rule, data.learn.question.examples)}
                </div>`;
        } else {
            if (currentQuestions.length === 0) {
                currentQuestions = getRandomQuestions(practicePool, 5);
            }
            floatingContainer.classList.remove("hidden");

            contentHTML = `
                <div class="space-y-4">
                    <div class="text-right text-xs text-slate-400 font-medium">Pool: ${practicePool.length} SÃ¤tze</div>
                    ${currentQuestions.map((item, idx) => `
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 transition-all focus-within:ring-2 focus-within:ring-blue-500/20 focus-within:border-blue-500 relative overflow-hidden">
                            <div class="absolute top-0 right-0 px-3 py-1 text-[10px] font-bold uppercase tracking-wider rounded-bl-xl ${
                                item.type === "neg" ? "bg-red-100 text-red-600" :
                                item.type === "ques" ? "bg-blue-100 text-blue-600" :
                                "bg-green-100 text-green-600"
                            }">
                                ${item.type === "neg" ? "Verneinung" : item.type === "ques" ? "Frage" : "Aussage"}
                            </div>

                            <p class="text-lg mb-3 font-medium text-slate-700 leading-relaxed pr-8">${item.q}</p>
                            <div class="flex gap-2">
                                <input type="text" id="input-${idx}" class="min-w-0 flex-1 bg-slate-50 border border-slate-300 rounded-xl p-3 text-lg outline-none focus:bg-white transition" placeholder="Antwort..." autocomplete="off">
                                <button onclick="checkAnswer(${idx}, '${item.a.replace(/'/g, "\\'")}')" class="bg-slate-800 text-white px-5 rounded-xl font-bold shadow-md hover:bg-slate-700 active:scale-95 transition">
                                    <span class="material-symbols-outlined">check</span>
                                </button>
                            </div>
                            <div id="feedback-${idx}" class="mt-3 hidden animate-pulse"></div>
                            ${item.hint ? `<button class="text-xs text-slate-400 mt-3 font-semibold hover:text-primary transition flex items-center gap-1" onclick="this.innerText='ðŸ’¡ ${item.hint}'"><span class="material-symbols-outlined text-sm">lightbulb</span> Tipp?</button>` : ""}
                        </div>
                    `).join("")}
                </div>`;
        }

        container.innerHTML = banner + modeSwitcher + contentHTML;
        mainContent.appendChild(container);
    }

    function switchMode(mode) {
        currentMode = mode;
        currentQuestions = [];
        renderContent();
    }

    function reloadQuestions() {
        currentQuestions = [];
        renderContent();
        document.getElementById("main-content").scrollTop = 0;
    }

    function checkAnswer(idx, correct) {
        const input = document.getElementById(`input-${idx}`);
        const feedback = document.getElementById(`feedback-${idx}`);
        const userVal = input.value.trim();
        feedback.classList.remove("hidden", "animate-pulse");

        const cleanUser = userVal.toLowerCase().replace(/\s+/g, " ").replace(/â€™/g, "'");
        const cleanCorrect = correct.toLowerCase().replace(/\s+/g, " ").replace(/â€™/g, "'");

        if (cleanUser === cleanCorrect) {
            input.className = "min-w-0 flex-1 bg-green-50 border-2 border-green-500 text-green-800 rounded-xl p-3 text-lg outline-none font-medium";
            feedback.innerHTML = `<div class="bg-green-100 text-green-700 p-2 rounded-lg text-sm font-bold flex items-center gap-2"><span class="material-symbols-outlined">check_circle</span> Richtig!</div>`;
        } else {
            input.className = "min-w-0 flex-1 bg-red-50 border-2 border-red-500 text-red-800 rounded-xl p-3 text-lg outline-none font-medium";
            feedback.innerHTML = `<div class="bg-red-100 text-red-700 p-2 rounded-lg text-sm font-medium flex items-center gap-2"><span class="material-symbols-outlined">cancel</span> Leider falsch. <br>LÃ¶sung: <span class="font-bold underline ml-1">${correct}</span></div>`;
        }
    }
</script>
</body>
</html>
